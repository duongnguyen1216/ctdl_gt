class Node:
    def __init__(self, leaf=True):
        self.keys = []          # chứa tối đa 3 khóa
        self.children = []      # chứa tối đa 4 con
        self.leaf = leaf


class Tree234:
    def __init__(self):
        self.root = Node()

    # Tách node đầy (3 khóa)
    def split_child(self, parent, index):
        full_node = parent.children[index]
        new_node = Node(full_node.leaf)

        # key giữa đưa lên parent
        mid_key = full_node.keys[1]

        # new_node lấy key cuối
        new_node.keys = [full_node.keys[2]]

        # full_node giữ key đầu
        full_node.keys = [full_node.keys[0]]

        # nếu không phải lá thì chia children
        if not full_node.leaf:
            new_node.children = full_node.children[2:]
            full_node.children = full_node.children[:2]

        parent.keys.insert(index, mid_key)
        parent.children.insert(index + 1, new_node)

    # Chèn vào node chưa đầy
    def insert_non_full(self, node, key):
        if node.leaf:
            node.keys.append(key)
            node.keys.sort()
        else:
            i = len(node.keys) - 1
            while i >= 0 and key < node.keys[i]:
                i -= 1
            i += 1

            # nếu con sắp đi xuống đầy → split trước
            if len(node.children[i].keys) == 3:
                self.split_child(node, i)
                if key > node.keys[i]:
                    i += 1

            self.insert_non_full(node.children[i], key)

    # Hàm insert chính
    def insert(self, key):
        root = self.root

        # nếu root đầy → tạo root mới
        if len(root.keys) == 3:
            new_root = Node(leaf=False)
            new_root.children.append(self.root)
            self.split_child(new_root, 0)
            self.root = new_root

        self.insert_non_full(self.root, key)

    # Duyệt inorder
    def inorder(self, node):
        if node:
            for i in range(len(node.keys)):
                if not node.leaf:
                    self.inorder(node.children[i])
                print(node.keys[i], end=" ")
            if not node.leaf:
                self.inorder(node.children[len(node.keys)])

    def display(self):
        self.inorder(self.root)
        print()


# ================= TEST =================
if __name__ == "__main__":
    t = Tree234()

    data = [10, 20, 5, 6, 12, 30, 7, 17]

    for x in data:
        t.insert(x)

    print("Duyệt Inorder:")
    t.display()
